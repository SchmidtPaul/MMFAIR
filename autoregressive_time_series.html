<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Repeated Measures in Time</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/lumen.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<!--All these are favicons-->
<link rel="apple-touch-icon" sizes="180x180" href="img/logo/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="img/logo/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="img/logo/favicon-16x16.png">
<link rel="manifest" href="img/logo/site.webmanifest">
<link rel="mask-icon" href="img/logo/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="img/logo/favicon.ico">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="msapplication-config" content="img/logo/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!--SAS syntax highlighting-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.31.0/codemirror.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.31.0/codemirror.min.js"></script>
<style>
  .CodeMirror {
    border: 1px solid #eee;
    height: auto;
  }
</style>

<!--Metatags = preview image when linking to social media-->

<!-- Primary Meta Tags -->
<!-- <title>Mixed Models for Agriculture in R</title> -->
<!-- <meta name="title" content="Mixed Models for Agriculture in R">  -->
<meta name="description" content="Our aim is to provide a cookbook with mixed model analyses of typical examples in life sciences (focus on agriculture/biology) and compare the possibilities or rather limitations of the R-packages nlme, lme4, glmmTMB and sommer to each other, but also to SAS’ PROC MIXED.">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://schmidtpaul.github.io/MMFAIR/index.html">
<meta property="og:title" content="Mixed Models for Agriculture in R">
<meta property="og:description" content="Our aim is to provide a cookbook with mixed model analyses of typical examples in life sciences (focus on agriculture/biology) and compare the possibilities or rather limitations of the R-packages nlme, lme4, glmmTMB and sommer to each other, but also to SAS’ PROC MIXED.">
<meta property="og:image" content="img/logo/ScreenshotIndex.PNG">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://schmidtpaul.github.io/MMFAIR/index.html">
<meta property="twitter:title" content="Mixed Models for Agriculture in R">
<meta property="twitter:description" content="Our aim is to provide a cookbook with mixed model analyses of typical examples in life sciences (focus on agriculture/biology) and compare the possibilities or rather limitations of the R-packages nlme, lme4, glmmTMB and sommer to each other, but also to SAS’ PROC MIXED.">
<meta property="twitter:image" content="img/logo/ScreenshotIndex.PNG">

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
      a.sourceLine { display: inline-block; line-height: 1.25; }
  a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
  a.sourceLine:empty { height: 1.2em; }
  .sourceCode { overflow: visible; }
  code.sourceCode { white-space: pre; position: relative; }
  div.sourceCode { margin: 1em 0; }
  pre.sourceCode { margin: 0; }
  @media screen {
  div.sourceCode { overflow: auto; }
  }
  @media print {
  code.sourceCode { white-space: pre-wrap; }
  a.sourceLine { text-indent: -1em; padding-left: 1em; }
  }
  pre.numberSource a.sourceLine
    { position: relative; left: -4em; }
  pre.numberSource a.sourceLine::before
    { content: attr(title);
      position: relative; left: -1em; text-align: right; vertical-align: baseline;
      border: none; pointer-events: all; display: inline-block;
      -webkit-touch-callout: none; -webkit-user-select: none;
      -khtml-user-select: none; -moz-user-select: none;
      -ms-user-select: none; user-select: none;
      padding: 0 4px; width: 4em;
      color: #aaaaaa;
    }
  pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
  div.sourceCode
    { background-color: #f8f8f8; }
  @media screen {
  a.sourceLine::before { text-decoration: underline; }
  }
  code span.al { color: #ef2929; } /* Alert */
  code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
  code span.at { color: #c4a000; } /* Attribute */
  code span.bn { color: #0000cf; } /* BaseN */
  code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
  code span.ch { color: #4e9a06; } /* Char */
  code span.cn { color: #000000; } /* Constant */
  code span.co { color: #8f5902; font-style: italic; } /* Comment */
  code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
  code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
  code span.dt { color: #204a87; } /* DataType */
  code span.dv { color: #0000cf; } /* DecVal */
  code span.er { color: #a40000; font-weight: bold; } /* Error */
  code span.ex { } /* Extension */
  code span.fl { color: #0000cf; } /* Float */
  code span.fu { color: #000000; } /* Function */
  code span.im { } /* Import */
  code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
  code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
  code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
  code span.ot { color: #8f5902; } /* Other */
  code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
  code span.sc { color: #000000; } /* SpecialChar */
  code span.ss { color: #4e9a06; } /* SpecialString */
  code span.st { color: #4e9a06; } /* String */
  code span.va { color: #000000; } /* Variable */
  code span.vs { color: #4e9a06; } /* VerbatimString */
  code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 54px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h2 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h3 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h4 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h5 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h6 {
  padding-top: 59px;
  margin-top: -59px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">MMFAIR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Chapters
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="heterogeneous_error_variance.html">Heterogeneous error variance</a>
    </li>
    <li>
      <a href="autoregressive_time_series.html">First-order autoregressive</a>
    </li>
    <li>
      <a href="weighted_two_stage.html">Weighted two-stage analyses</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Summaries
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="variance_structures.html">Variance Structures</a>
    </li>
    <li>
      <a href="model_selection.html">Model Selection</a>
    </li>
  </ul>
</li>
<li>
  <a href="sources.html">Sources</a>
</li>
<li>
  <a href="0contactinfo.html">Contact</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Repeated Measures in Time</h1>

</div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.31.0/mode/sas/sas.min.js"></script>

<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># packages</span></a>
<a class="sourceLine" id="cb1-2" title="2">pacman<span class="op">::</span><span class="kw">p_load</span>(dplyr, purrr, tibble, tidyr, stringr, <span class="co"># data handling</span></a>
<a class="sourceLine" id="cb1-3" title="3">               gganimate, ggplot2, gifski, viridis,  <span class="co"># plot</span></a>
<a class="sourceLine" id="cb1-4" title="4">               nlme, lme4, glmmTMB, sommer, <span class="co"># mixed modelling</span></a>
<a class="sourceLine" id="cb1-5" title="5">               AICcmodavg, mixedup)         <span class="co"># mixed model extractions</span></a>
<a class="sourceLine" id="cb1-6" title="6"></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co"># data</span></a>
<a class="sourceLine" id="cb1-8" title="8">dat &lt;-<span class="st"> </span>agriTutorial<span class="op">::</span>sorghum <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">block =</span> Replicate, <span class="dt">plot =</span> factplot) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(y, variety, block, plot, factweek, varweek) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="st">  </span><span class="kw">as_tibble</span>()</a></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; ">
<table class="table table-bordered table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
y
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
variety
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
block
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
plot
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
factweek
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
varweek
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
5.00
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4.84
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4.02
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
3.75
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
3.13
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
4.42
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4.30
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3.67
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
3.23
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2.83
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
4.42
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4.10
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3.46
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
3.09
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2.82
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
4.01
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3.89
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3.21
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2.89
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2.56
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
3.36
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3.10
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2.67
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2.47
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2.16
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
5.82
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
5.60
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
5.05
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.72
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
4.46
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
5.73
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
5.59
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
5.00
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.65
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
4.42
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
5.31
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
5.19
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4.86
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.44
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
4.22
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
4.92
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4.66
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4.56
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.16
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
3.99
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
3.96
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3.86
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3.50
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
3.13
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2.95
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
5.65
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
5.97
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
5.27
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
5.07
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
4.52
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
5.39
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
5.49
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
5.08
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.87
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
4.32
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
5.15
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
5.28
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4.93
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.67
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
4.15
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
4.50
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
14
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4.89
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
14
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4.74
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
14
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.49
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
14
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
4.10
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
14
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
3.75
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
15
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3.74
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
15
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3.55
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
15
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
3.28
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
15
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
3.00
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
15
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
5.86
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
16
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
5.60
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
16
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
5.37
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
16
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
5.00
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
16
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
4.37
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
16
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
5.82
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
17
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
5.55
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
17
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
5.29
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
17
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.95
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
17
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
4.07
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
17
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
5.26
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
5.06
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4.76
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.48
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
3.94
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
4.87
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
19
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4.75
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
19
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4.55
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
19
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
4.33
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
19
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
3.83
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
19
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
3.96
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
20
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3.76
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
20
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
3.56
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
20
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
3.18
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
20
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
2.96
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
20
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
</tbody>
</table>
</div>
<p><br/></p>
<div id="motivation" class="section level1">
<h1>Motivation</h1>
<p>The example in this chapter is taken from <a href="https://onlinelibrary.wiley.com/doi/full/10.1111/jac.12267" target="_blank"><em>Example 4</em> in Piepho &amp; Edmondson (2018)</a> (see also the <a href="https://cran.r-project.org/web/packages/agriTutorial/vignettes/agriTutorialVignette.pdf#%5B%7B%22num%22%3A81%2C%22gen%22%3A0%7D%2C%7B%22name%22%3A%22XYZ%22%7D%2C28.346%2C813.543%2Cnull%5D" target="_blank">Agritutorial vigniette</a>). It considers data from a sorghum trial laid out as a randomized complete <code>block</code> design (5 blocks) with <code>variety</code> (4 sorghum varities) being the only treatment factor. Thus, we have a total of 20 <code>plot</code>s. It is important to note that our response variable (<code>y</code>), <strong>the leaf area index, was assessed in five consecutive weeks on each plot</strong> starting 2 weeks after emergence. Therefore, the dataset contains a total of 100 values and what we have here is longitudinal data, <em>a.k.a.</em> repeated measurements over time, <em>a.k.a.</em> a time series analysis.</p>
<p>As <a href="https://onlinelibrary.wiley.com/doi/full/10.1111/jac.12267" target="_blank">Piepho &amp; Edmondson (2018)</a> put it: <em>“the week factor is not a treatment factor that can be randomized. Instead, repeated measurements are taken on each plot on five consecutive occasions. Successive measurements on the same plot are likely to be serially correlated, and this means that for a reliable and efficient analysis of repeated-measures data we need to take proper account of the serial correlations between the repeated measures (<a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1439-037X.2004.00097.x" target="_blank">Piepho, Büchse &amp; Richter, 2004</a>; <a href="http://library.mpib-berlin.mpg.de/toc/z2008_18.pdf" target="_blank">Pinheiro &amp; Bates, 2000</a>).”</em></p>
<pre><code>## 
Rendering [&gt;--------------------------------------------] at 6.6 fps ~ eta: 15s
Rendering [&gt;--------------------------------------------] at 6.5 fps ~ eta: 15s
Rendering [=&gt;-------------------------------------------] at 6.3 fps ~ eta: 15s
Rendering [==&gt;------------------------------------------] at 6.3 fps ~ eta: 15s
Rendering [===&gt;-----------------------------------------] at 6.4 fps ~ eta: 14s
Rendering [===&gt;-----------------------------------------] at 6.3 fps ~ eta: 14s
Rendering [====&gt;----------------------------------------] at 6.3 fps ~ eta: 14s
Rendering [=====&gt;---------------------------------------] at 6.3 fps ~ eta: 14s
Rendering [======&gt;--------------------------------------] at 6.3 fps ~ eta: 13s
Rendering [=======&gt;-------------------------------------] at 6.3 fps ~ eta: 13s
Rendering [========&gt;------------------------------------] at 5.8 fps ~ eta: 14s
Rendering [=========&gt;-----------------------------------] at 5.8 fps ~ eta: 13s
Rendering [=========&gt;-----------------------------------] at 5.9 fps ~ eta: 13s
Rendering [==========&gt;----------------------------------] at 5.9 fps ~ eta: 13s
Rendering [===========&gt;---------------------------------] at 5.9 fps ~ eta: 12s
Rendering [============&gt;--------------------------------] at 5.9 fps ~ eta: 12s
Rendering [=============&gt;-------------------------------] at 5.9 fps ~ eta: 12s
Rendering [==============&gt;------------------------------] at 5.9 fps ~ eta: 11s
Rendering [==============&gt;------------------------------] at 5.8 fps ~ eta: 11s
Rendering [===============&gt;-----------------------------] at 5.8 fps ~ eta: 11s
Rendering [================&gt;----------------------------] at 5.8 fps ~ eta: 11s
Rendering [=================&gt;---------------------------] at 5.8 fps ~ eta: 10s
Rendering [==================&gt;--------------------------] at 5.8 fps ~ eta: 10s
Rendering [===================&gt;-------------------------] at 5.8 fps ~ eta: 10s
Rendering [====================&gt;------------------------] at 5.7 fps ~ eta:  9s
Rendering [=====================&gt;-----------------------] at 5.7 fps ~ eta:  9s
Rendering [======================&gt;----------------------] at 5.7 fps ~ eta:  9s
Rendering [======================&gt;----------------------] at 5.7 fps ~ eta:  8s
Rendering [=======================&gt;---------------------] at 5.7 fps ~ eta:  8s
Rendering [========================&gt;--------------------] at 5.7 fps ~ eta:  8s
Rendering [========================&gt;--------------------] at 5.6 fps ~ eta:  8s
Rendering [=========================&gt;-------------------] at 5.6 fps ~ eta:  8s
Rendering [=========================&gt;-------------------] at 5.6 fps ~ eta:  7s
Rendering [==========================&gt;------------------] at 5.6 fps ~ eta:  7s
Rendering [===========================&gt;-----------------] at 5.5 fps ~ eta:  7s
Rendering [============================&gt;----------------] at 5.5 fps ~ eta:  7s
Rendering [============================&gt;----------------] at 5.5 fps ~ eta:  6s
Rendering [=============================&gt;---------------] at 5.5 fps ~ eta:  6s
Rendering [=============================&gt;---------------] at 5.4 fps ~ eta:  6s
Rendering [==============================&gt;--------------] at 5.4 fps ~ eta:  6s
Rendering [===============================&gt;-------------] at 5.4 fps ~ eta:  5s
Rendering [================================&gt;------------] at 5.4 fps ~ eta:  5s
Rendering [=================================&gt;-----------] at 5.4 fps ~ eta:  5s
Rendering [=================================&gt;-----------] at 5.3 fps ~ eta:  4s
Rendering [==================================&gt;----------] at 5.3 fps ~ eta:  4s
Rendering [===================================&gt;---------] at 5.3 fps ~ eta:  4s
Rendering [====================================&gt;--------] at 5.3 fps ~ eta:  3s
Rendering [====================================&gt;--------] at 5.2 fps ~ eta:  3s
Rendering [=====================================&gt;-------] at 5.2 fps ~ eta:  3s
Rendering [======================================&gt;------] at 5.2 fps ~ eta:  3s
Rendering [=======================================&gt;-----] at 5.2 fps ~ eta:  2s
Rendering [========================================&gt;----] at 5.2 fps ~ eta:  2s
Rendering [========================================&gt;----] at 5.1 fps ~ eta:  2s
Rendering [=========================================&gt;---] at 5.1 fps ~ eta:  1s
Rendering [==========================================&gt;--] at 5.1 fps ~ eta:  1s
Rendering [===========================================&gt;-] at 5.1 fps ~ eta:  1s
Rendering [===========================================&gt;-] at 5.1 fps ~ eta:  0s
Rendering [============================================&gt;] at 5.1 fps ~ eta:  0s
Rendering [===============================================] at 5 fps ~ eta:  0s
                                                                               </code></pre>
<pre><code>## 
Frame 1 (1%)
Frame 2 (2%)
Frame 3 (3%)
Frame 4 (4%)
Frame 5 (5%)
Frame 6 (6%)
Frame 7 (7%)
Frame 8 (8%)
Frame 9 (9%)
Frame 10 (10%)
Frame 11 (11%)
Frame 12 (12%)
Frame 13 (13%)
Frame 14 (14%)
Frame 15 (15%)
Frame 16 (16%)
Frame 17 (17%)
Frame 18 (18%)
Frame 19 (19%)
Frame 20 (20%)
Frame 21 (21%)
Frame 22 (22%)
Frame 23 (23%)
Frame 24 (24%)
Frame 25 (25%)
Frame 26 (26%)
Frame 27 (27%)
Frame 28 (28%)
Frame 29 (29%)
Frame 30 (30%)
Frame 31 (31%)
Frame 32 (32%)
Frame 33 (33%)
Frame 34 (34%)
Frame 35 (35%)
Frame 36 (36%)
Frame 37 (37%)
Frame 38 (38%)
Frame 39 (39%)
Frame 40 (40%)
Frame 41 (41%)
Frame 42 (42%)
Frame 43 (43%)
Frame 44 (44%)
Frame 45 (45%)
Frame 46 (46%)
Frame 47 (47%)
Frame 48 (48%)
Frame 49 (49%)
Frame 50 (50%)
Frame 51 (51%)
Frame 52 (52%)
Frame 53 (53%)
Frame 54 (54%)
Frame 55 (55%)
Frame 56 (56%)
Frame 57 (57%)
Frame 58 (58%)
Frame 59 (59%)
Frame 60 (60%)
Frame 61 (61%)
Frame 62 (62%)
Frame 63 (63%)
Frame 64 (64%)
Frame 65 (65%)
Frame 66 (66%)
Frame 67 (67%)
Frame 68 (68%)
Frame 69 (69%)
Frame 70 (70%)
Frame 71 (71%)
Frame 72 (72%)
Frame 73 (73%)
Frame 74 (74%)
Frame 75 (75%)
Frame 76 (76%)
Frame 77 (77%)
Frame 78 (78%)
Frame 79 (79%)
Frame 80 (80%)
Frame 81 (81%)
Frame 82 (82%)
Frame 83 (83%)
Frame 84 (84%)
Frame 85 (85%)
Frame 86 (86%)
Frame 87 (87%)
Frame 88 (88%)
Frame 89 (89%)
Frame 90 (90%)
Frame 91 (91%)
Frame 92 (92%)
Frame 93 (93%)
Frame 94 (94%)
Frame 95 (95%)
Frame 96 (96%)
Frame 97 (97%)
Frame 98 (98%)
Frame 99 (99%)
Frame 100 (100%)
## Finalizing encoding... done!</code></pre>
<p><img src="autoregressive_time_series_files/figure-html/unnamed-chunk-5-1.gif" /><!-- --></p>
</div>
<div id="modelling" class="section level1">
<h1>Modelling</h1>
<p>Our goal is therefore to build a suitable model taking serial correlation into account. In order to do this, we will initially consider the model for a single time point. Then, we extend this model to account for multiple weeks by allowing for week-speficic effects. Finally, we further allow for serially correlated error terms.</p>
</div>
<div id="sinlge-week" class="section level1">
<h1>Sinlge week</h1>
<p>When looking at data from a single time point (<em>e.g.</em> the first week), we merely have 20 observations from a randomized complete block design with a single treatment factor. It can therefore be analyzed with a simple one-way ANOVA (fixed <code>variety</code> effect) for randomized complete block designs (fixed <code>block</code> effect):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">dat.wk1 &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(factweek <span class="op">==</span><span class="st"> &quot;1&quot;</span>) <span class="co"># subset data from first week only</span></a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3">mod.wk1 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>variety <span class="op">+</span><span class="st"> </span>block,</a>
<a class="sourceLine" id="cb4-4" title="4">              <span class="dt">data =</span> dat.wk1)</a></code></pre></div>
<p>We could now go on and look at the ANOVA via <code>anova(mod.wk1)</code> and it would indeed not be <em>wrong</em> to simply repeat this for each week. Yet, one may not be satisfied with obtaining multiple ANOVA results - namely one per week. This is especially likeliy in case the results contradict each other, because <em>e.g.</em> the variety effects are found to be significant in only two out of five weeks. Therefore, one may want to analyze the entire dataset <em>i.e.</em> the multiple weeks jointly.</p>
</div>
<div id="multiple-weeks---independent-errors" class="section level1 tabset tabset-fade tabset-pills">
<h1>Multiple weeks - independent errors</h1>
<p>Going from the single-week-analysis to jointly analyzing the entire dataset is more than just changing the <code>data =</code> statement in the model. This is because <em>“it is realistic to assume that the treatment effects evolve over time and thus are week-specific. Importantly, we must also allow for the block effects to change over time in an individual manner. For example, there could be fertility or soil type differences between blocks and these could have a smooth progressive or cumulative time-based effect on differences between the blocks dependent on factors such as temperature or rainfall”</em> <a href="https://onlinelibrary.wiley.com/doi/full/10.1111/jac.12267" target="_blank">(Piepho &amp; Edmondson, 2018)</a>. We implement this by taking the model in <code>mod.wk1</code> and multipyling each effect with <code>factweek</code>. Note that this is also true for the general interecept (µ) in <code>mod.wk1</code>, meaning that we would like to include one intercept per week, which can be achieved by simply adding <code>factweek</code> as a main effect as well. This leaves us with fixed main effects for <code>factweek</code>, <code>variety</code>, and <code>block</code>, as well as the week-specific effects of the latter two <code>factweek:variety</code> and <code>factweek:block</code>.</p>
<p>Finally, note that we are not doing anything about the model’s error term at this point. More specifically this means that its variance structure is still the default <strong>iid</strong> (independent and identically distributed) - see <a href="variance_structures.html" target="_blank">our summary on correlation/variance strucutres here</a>.</p>
<div id="nlme" class="section level2">
<h2>nlme</h2>
<p>Since the models in this chapter do not contain any random effects, we make use of <code>gls()</code> instead of <code>lme()</code>. Furthermore, the above named model <code>factweek + variety + block + factweek:variety + factweek:block</code> can be written in a shorter syntax as:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">mod.iid.nlme &lt;-<span class="st"> </span>nlme<span class="op">::</span><span class="kw">gls</span>(<span class="dt">model =</span> y <span class="op">~</span><span class="st"> </span>factweek <span class="op">*</span><span class="st"> </span>(variety <span class="op">+</span><span class="st"> </span>block),</a>
<a class="sourceLine" id="cb5-2" title="2">                          <span class="dt">correlation =</span> <span class="ot">NULL</span>, <span class="co"># default, i.e. homoscedastic, independent errors</span></a>
<a class="sourceLine" id="cb5-3" title="3">                          <span class="dt">data =</span> dat)</a>
<a class="sourceLine" id="cb5-4" title="4"></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co"># Extract variance component estimates</span></a>
<a class="sourceLine" id="cb5-6" title="6">mod.iid.nlme.VC &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">varstruct =</span> <span class="st">&quot;iid&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sigma    =</span> mod.iid.nlme<span class="op">$</span>sigma) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Variance =</span> sigma<span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
<table class="table table-bordered table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
varstruct
</th>
<th style="text-align:right;">
sigma
</th>
<th style="text-align:right;">
Variance
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
iid
</td>
<td style="text-align:right;">
0.152
</td>
<td style="text-align:right;">
0.023
</td>
</tr>
</tbody>
</table>
</div>
<div id="lme4" class="section level2">
<h2>lme4</h2>
<p>Since the models in this chapter do not contain any random effects, we cannot use <code>lmer()</code> or any other function of the <code>lme4</code> package. However, even if there were random effects in our models, the short answer here is that with <code>lme4</code> it is <strong>not possible</strong> to fit any variance structures.</p>
<p>More specifically, we can read in an <a href="https://cran.r-project.org/web/packages/lme4/vignettes/lmer.pdf" target="_blank"><code>lme4</code> vigniette</a>: <em>“The main advantage of <code>nlme</code> relative to <code>lme4</code> is a user interface for fitting models with structure in the residuals (various forms of heteroscedasticity and autocorrelation) and in the random-effects covariance matrices (e.g., compound symmetric models). With some extra effort, the computational machinery of <code>lme4</code> can be used to fit structured models that the basic <code>lmer</code> function cannot handle (see <a href="https://cran.r-project.org/web/packages/lme4/vignettes/lmer.pdf#%5B%7B%22num%22%3A15%2C%22gen%22%3A0%7D%2C%7B%22name%22%3A%22XYZ%22%7D%2C81%2C733.028%2Cnull%5D" target="_blank">Appendix A</a>)”</em></p>
<p>Michael Clark <a href="https://m-clark.github.io/mixed-models-with-R/extensions.html#heterogeneous-variance" target="_blank">puts it as</a> <em>“Unfortunately, lme4 does not provide the ability to model the residual covariance structure, at least <a href="https://bbolker.github.io/mixedmodels-misc/notes/corr_braindump.html" target="_blank">not in a straightforward fashion</a>”</em></p>
<p><span style="color:red">Accordingly, there is no info on this package for this chapter beyond this point.</span></p>
<p><br/></p>
</div>
<div id="glmmtmb" class="section level2">
<h2>glmmTMB</h2>
<p>In <code>glmmTMB()</code> it is -to our knowledge- not possible to adjust the variance structure of the error.</p>
<blockquote>
<p>Just like in <code>nlme</code>, there is a <code>weights=</code> argument in <code>glmmTMB()</code>. However, to our understanding, they have different functions:</p>
<p>In <code>nlme</code>, it requires <em>“an optional <code>varFunc</code> object or one-sided formula describing the within-group heteroscedasticity structure”</em> <a href="https://cran.r-project.org/web/packages/glmmTMB/glmmTMB.pdf#Rfn.glmmTMB.1" target="_blank">(nlme RefMan)</a> and we make use of this in the chapter at hand.</p>
<p>In <code>glmmTMB</code>, the <a href="https://cran.r-project.org/web/packages/glmmTMB/glmmTMB.pdf#Rfn.glmmTMB.1" target="_blank">RefMan</a> only states <em>“weights, as in <code>glm</code>. Not automatically scaled to have sum 1”</em>. Following this trail, the <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/glm.html" target="_blank"><code>glm</code> documentation</a> description for the <code>weights=</code> argument is <em>“an optional vector of ‘prior weights’ to be used in the fitting process. Should be NULL or a numeric vector.”</em>. Accordingly, it cannot be used to allow for heterogeneous error variances in this package.</p>
</blockquote>
<p>We can, however, “<em>fix the residual variance to be 0 (actually a small non-zero value)</em>” and therefore “<em>force variance into the random effects</em>” <a href="https://cran.r-project.org/web/packages/glmmTMB/glmmTMB.pdf#Rfn.glmmTMB.1" target="_blank">(glmmTMB RefMan)</a> via adding the <code>dispformula = ~ 0</code> argument. Thus, when doing so, we need to make sure to also add a random term to the model with the desired variance structure. By taking both of these actions, we are essentially mimicing the error (variance) as a random effect (variance). We achieve this by first creating a <code>unit</code> column in the data with different entries for each data point.</p>
<p>Note that doing this may not be necessary for <code>mod.iid.glmm</code> with the default homoscedastic, independent error variance structure, but since it will be necessary for the following model with a more sophisticated variance structure, we will apply it here, too.</p>
<p>Finally, for extracting the variance component estimates from <code>glmmTMB</code> objects in this chapter, we use the <code>extract_vc</code> function from the <a href="https://github.com/m-clark/mixedup" target="_blank"><code>mixedup</code> helper package</a>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">unit =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>() <span class="op">%&gt;%</span><span class="st"> </span>as.factor) <span class="co"># new column with running number</span></a>
<a class="sourceLine" id="cb6-3" title="3"></a>
<a class="sourceLine" id="cb6-4" title="4">mod.iid.glmm &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(<span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>factweek <span class="op">*</span><span class="st"> </span>(variety <span class="op">+</span><span class="st"> </span>block) </a>
<a class="sourceLine" id="cb6-5" title="5">                        <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>unit),      <span class="co"># add random unit term to mimic error variance</span></a>
<a class="sourceLine" id="cb6-6" title="6">                        <span class="dt">dispformula =</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>, <span class="co"># fix original error variance to 0</span></a>
<a class="sourceLine" id="cb6-7" title="7">                        <span class="dt">REML =</span> <span class="ot">TRUE</span>,       <span class="co"># needs to be stated since default = ML</span></a>
<a class="sourceLine" id="cb6-8" title="8">                        <span class="dt">data =</span> dat) </a>
<a class="sourceLine" id="cb6-9" title="9"></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co"># Extract variance component estimates</span></a>
<a class="sourceLine" id="cb6-11" title="11">mod.iid.glmm.VC &lt;-<span class="st"> </span>mod.iid.glmm <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="st">  </span><span class="kw">extract_vc</span>(<span class="dt">ci_scale =</span> <span class="st">&quot;var&quot;</span>)</a></code></pre></div>
<table class="table table-bordered table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
group
</th>
<th style="text-align:left;">
effect
</th>
<th style="text-align:right;">
variance
</th>
<th style="text-align:right;">
var_2.5
</th>
<th style="text-align:right;">
var_97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
unit
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
0.023
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
0.033
</td>
</tr>
<tr>
<td style="text-align:left;">
Residual
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table>
</div>
<div id="sommer" class="section level2">
<h2>sommer</h2>
<p>It is quite easy to extract variance component estimates from <code>sommer</code> objects in a table format we are used to:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">mod.iid.somm &lt;-<span class="st"> </span><span class="kw">mmer</span>(<span class="dt">fixed =</span> y <span class="op">~</span><span class="st"> </span>factweek <span class="op">+</span><span class="st"> </span>variety <span class="op">+</span><span class="st"> </span>block <span class="op">+</span><span class="st"> </span>factweek<span class="op">:</span>variety <span class="op">+</span><span class="st"> </span>factweek<span class="op">:</span>block, </a>
<a class="sourceLine" id="cb7-2" title="2">                     <span class="dt">rcov  =</span> <span class="op">~</span><span class="st"> </span>units, <span class="co"># default = iid</span></a>
<a class="sourceLine" id="cb7-3" title="3">                     <span class="dt">data  =</span> dat, <span class="dt">verbose=</span>F)</a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co"># Extract variance component estimates</span></a>
<a class="sourceLine" id="cb7-6" title="6">mod.iid.somm.VC &lt;-<span class="st"> </span><span class="kw">summary</span>(mod.iid.somm)<span class="op">$</span>varcomp </a></code></pre></div>
<table class="table table-bordered table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
grp
</th>
<th style="text-align:right;">
VarComp
</th>
<th style="text-align:right;">
VarCompSE
</th>
<th style="text-align:right;">
Zratio
</th>
<th style="text-align:left;">
Constraint
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
units.y-y
</td>
<td style="text-align:right;">
0.023
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
5.477
</td>
<td style="text-align:left;">
Positive
</td>
</tr>
</tbody>
</table>
</div>
<div id="sas" class="section level2">
<h2>SAS</h2>
<p>In SAS, there is an actual <code>subject=</code> statement that is used to identify the subjects on which repeated measurements are taken. This may not be necessary for the <code>iid</code> with the default homoscedastic, independent error variance structure, but since it will be necessary for the following model with a more sophisticated variance structure, we will apply it here, too. In the end, the entire <code>repeated</code> line below could also be left out as it simply explicitly states the default setting.</p>


<textarea id="VGYNA">
proc mixed data=dat;
class variety block factweek plot;
model y=block variety factweek block*factweek variety*factweek /ddfm=kr2;
repeated factweek/sub=plot type=VC rcorr; /* = default iid */
ods output covparms=modiidsasVC FitStatistics=modiidsasAIC;
run; 

proc print data=modiidsasVC;
run;
</textarea>
<script> var codeElement = document.getElementById("VGYNA"); var editor = null; if (null != codeElement) { editor = CodeMirror.fromTextArea(codeElement, { lineNumbers: true, readOnly: true, viewportMargin: Infinity, mode: 'text/x-sas' }); } </script>

<p><br/></p>
<table class="table table-bordered table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
mod
</th>
<th style="text-align:left;">
CovParm
</th>
<th style="text-align:left;">
Subject
</th>
<th style="text-align:right;">
Estimate
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
iid
</td>
<td style="text-align:left;">
factweek
</td>
<td style="text-align:left;">
plot
</td>
<td style="text-align:right;">
0.023
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="multiple-weeks---autocorrelated-errors" class="section level1 tabset tabset-fade tabset-pills">
<h1>Multiple weeks - autocorrelated errors</h1>
<p>Note that at this point of the analysis, the model above with an independent, homogeneous error term above is neither the right, nor the wrong choice. It must be clear that <em>“measurements on the same plot are <strong>likely</strong> to be serially correlated”</em>. Thus, it should be investigated whether any covariance structure for the error term (instead of the default independence between errors) is more appropriate to model this dataset. It could theoretically be the case that this <code>mod.iid</code> is the best choice here, but we cannot confirm this yet, as we have not looked at any alternatives. This is what we will do in the next step.</p>
<blockquote>
<p>One may ask <strong>at what step of the analysis it is best to compare and find the appropriate covariance structure for the error term</strong> in such a scenario. It is indeed here, at this step. As <a href="https://onlinelibrary.wiley.com/doi/full/10.1111/jac.12267" target="_blank">Piepho &amp; Edmondson (2018)</a> write: <em>“<strong>Before modelling the treatment effect</strong>, a variance–covariance model needs to be identified for these correlations. This is best done by using a saturated model for treatments and time, i.e., a model that considers all treatment factors and time as qualitative.”</em></p>
<p><br/></p>
<p>Note that this <em>saturated model</em> is what we have in <code>mod.iid</code>. So in short: one should compare variance structures for the error term <strong>before</strong> running an ANOVA / conducting model selection steps.</p>
</blockquote>
<p>Units on which repeated observations are taken are often referred to as subjects. We would now like to allow measurements taken on the same subjects (plot in this case) to be serially correlated, while observations on different subjects are still considered independent. More specifically, we want the errors of the respective observations to be correlated in our model.</p>
<p><img src="img/corrvalues.PNG" style="width:60%; margin-right: 10px" align="left"></p>
<p>Take the visualisation on the left depicting a subset of our data. Here, you can see plots 1 and 2 (out of the total of 20 in our dataset) side by side. Furthermore, they are shown for weeks 1-3 (out of the total of 5 in our dataset). Thus, a total of six values are represented, coming from only two subjects/plots, but obtained in three different weeks. The blue arrows represent correlation among errors. For these six measurements, there are six blue arrows, since there are six error pairs that come from the same plot, respectively. The green lines on the other hand represent error pairs that do not come from the same plot and thus are assumed to be independent. Finally, notice that the errors coming from the same plot, but with two instead of just one week between their measurements, are shown in a lighter blue. This is because one may indeed assume a weaker correlation between errors that are further apart in terms of time passed between measurements.</p>
<p>The latter can be achieved by using the maybe most popular correlation structure for repeated measures over time: <strong>first order autoregressive AR(1)</strong>. Please find the section on AR(1) in <a href="variance_structures.html" target="_blank">our summary on correlation/variance strucutres here.</a> It should be noted that this correlation structure is useful, if all time points are equally spaced, which is the case here, as there is always exactly one week between consecutive time points.</p>
<blockquote>
<p>There are other possible models (<em>i.e.</em> <a href="variance_structures.html" target="_blank">other variance structures</a>) for serial correlation of longitudinal data, but for simplicity we will only compare the default <code>iid</code> model above with the <code>ar1</code> model below. In fact, <a href="https://onlinelibrary.wiley.com/doi/full/10.1111/jac.12267" target="_blank"><em>Example 4</em> in Piepho &amp; Edmondson (2018)</a> does investigate other models as well and you can find their <code>nlme</code> code in the <a href="https://cran.r-project.org/web/packages/agriTutorial/vignettes/agriTutorialVignette.pdf#%5B%7B%22num%22%3A81%2C%22gen%22%3A0%7D%2C%7B%22name%22%3A%22XYZ%22%7D%2C28.346%2C813.543%2Cnull%5D" target="_blank">Agritutorial vigniette</a>.</p>
</blockquote>
<div id="nlme-1" class="section level2">
<h2>nlme</h2>
<p>In <code>nlme</code> we make use of the <code>correlation =</code> argument and use the <code>corAR1</code> <a href="https://cran.r-project.org/web/packages/nlme/nlme.pdf#Rfn.corClasses.1" target="_blank">correlation strucutre class</a>. In its syntax, subjects are identified after the <code>|</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">mod.ar1.nlme &lt;-<span class="st"> </span>nlme<span class="op">::</span><span class="kw">gls</span>(<span class="dt">model =</span> y <span class="op">~</span><span class="st"> </span>factweek <span class="op">*</span><span class="st"> </span>(variety <span class="op">+</span><span class="st"> </span>block),</a>
<a class="sourceLine" id="cb8-2" title="2">                          <span class="dt">correlation =</span> <span class="kw">corAR1</span>(<span class="dt">form =</span> <span class="op">~</span><span class="st"> </span>varweek <span class="op">|</span><span class="st"> </span>plot),</a>
<a class="sourceLine" id="cb8-3" title="3">                          <span class="dt">data =</span> dat)</a>
<a class="sourceLine" id="cb8-4" title="4"></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="co"># Extract variance component estimates</span></a>
<a class="sourceLine" id="cb8-6" title="6">mod.ar1.nlme.VC &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">varstruct =</span> <span class="st">&quot;ar(1)&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sigma    =</span> mod.ar1.nlme<span class="op">$</span>sigma,</a>
<a class="sourceLine" id="cb8-8" title="8">         <span class="dt">rho      =</span> <span class="kw">coef</span>(mod.ar1.nlme<span class="op">$</span>modelStruct<span class="op">$</span>corStruct, <span class="dt">unconstrained =</span> <span class="ot">FALSE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Variance =</span> sigma<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb8-10" title="10">         <span class="dt">Corr1wk  =</span> rho,</a>
<a class="sourceLine" id="cb8-11" title="11">         <span class="dt">Corr2wks =</span> rho<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb8-12" title="12">         <span class="dt">Corr3wks =</span> rho<span class="op">^</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb8-13" title="13">         <span class="dt">Corr4wks =</span> rho<span class="op">^</span><span class="dv">4</span>)</a></code></pre></div>
<table class="table table-bordered table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
varstruct
</th>
<th style="text-align:right;">
sigma
</th>
<th style="text-align:right;">
rho
</th>
<th style="text-align:right;">
Variance
</th>
<th style="text-align:right;">
Corr1wk
</th>
<th style="text-align:right;">
Corr2wks
</th>
<th style="text-align:right;">
Corr3wks
</th>
<th style="text-align:right;">
Corr4wks
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
ar(1)
</td>
<td style="text-align:right;">
0.149
</td>
<td style="text-align:right;">
0.749
</td>
<td style="text-align:right;">
0.022
</td>
<td style="text-align:right;">
0.749
</td>
<td style="text-align:right;">
0.561
</td>
<td style="text-align:right;">
0.42
</td>
<td style="text-align:right;">
0.315
</td>
</tr>
</tbody>
</table>
</div>
<div id="lme4-1" class="section level2">
<h2>lme4</h2>
<p><span style="color:red">not possible - see above.</span></p>
</div>
<div id="glmmtmb-1" class="section level2">
<h2>glmmTMB</h2>
<p>To model the variance structure of our mimiced error term as first order autoregressive, we replace the <code>(1 | unit)</code> from the <code>iid</code> model with <code>ar1(factweek + 0 | plot)</code>. As can be seen, subjects are identified after the <code>|</code> and the variance structure in this syntax. Further notice that leaving out the <code>+ 0</code> would by default lead to estimating an additional overall variance (see <em>Details</em> for <a href="https://cran.r-project.org/web/packages/glmmTMB/glmmTMB.pdf#Rfn.glmmTMB.1" target="_blank"><code>glmmTMB</code> topic in the RefMan</a>).</p>
<p>Note that by adding the <code>show_cor = TRUE</code> argument to the <code>extract_vc</code> function, we obtain two outputs: The variance component estimates, as seen above for the <code>iid</code> model, as well as the correlation matrix / variance structure for a single plot.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">mod.ar1.glmm &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(<span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>factweek <span class="op">*</span><span class="st"> </span>(variety <span class="op">+</span><span class="st"> </span>block)</a>
<a class="sourceLine" id="cb9-2" title="2">                        <span class="op">+</span><span class="st"> </span><span class="kw">ar1</span>(factweek <span class="op">+</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>plot), <span class="co"># add ar1 structure as random term to mimic error variance</span></a>
<a class="sourceLine" id="cb9-3" title="3">                        <span class="dt">dispformula =</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>, <span class="co"># fix original error variance to 0</span></a>
<a class="sourceLine" id="cb9-4" title="4">                        <span class="dt">REML =</span> <span class="ot">TRUE</span>,       <span class="co"># needs to be stated since default = ML</span></a>
<a class="sourceLine" id="cb9-5" title="5">                        <span class="dt">data =</span> dat) </a>
<a class="sourceLine" id="cb9-6" title="6"></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="co"># Extract variance component estimates</span></a>
<a class="sourceLine" id="cb9-8" title="8">mod.ar1.glmm.VC &lt;-<span class="st"> </span>mod.ar1.glmm <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="st">  </span><span class="kw">extract_vc</span>(<span class="dt">ci_scale =</span> <span class="st">&quot;var&quot;</span>, <span class="dt">show_cor =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<table class="table table-bordered table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
group
</th>
<th style="text-align:left;">
effect
</th>
<th style="text-align:right;">
variance
</th>
<th style="text-align:right;">
var_2.5
</th>
<th style="text-align:right;">
var_97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
plot
</td>
<td style="text-align:left;">
factweek1
</td>
<td style="text-align:right;">
0.022
</td>
<td style="text-align:right;">
0.013
</td>
<td style="text-align:right;">
0.038
</td>
</tr>
<tr>
<td style="text-align:left;">
plot
</td>
<td style="text-align:left;">
factweek2
</td>
<td style="text-align:right;">
0.022
</td>
<td style="text-align:right;">
0.013
</td>
<td style="text-align:right;">
0.038
</td>
</tr>
<tr>
<td style="text-align:left;">
plot
</td>
<td style="text-align:left;">
factweek3
</td>
<td style="text-align:right;">
0.022
</td>
<td style="text-align:right;">
0.013
</td>
<td style="text-align:right;">
0.038
</td>
</tr>
<tr>
<td style="text-align:left;">
plot
</td>
<td style="text-align:left;">
factweek4
</td>
<td style="text-align:right;">
0.022
</td>
<td style="text-align:right;">
0.013
</td>
<td style="text-align:right;">
0.038
</td>
</tr>
<tr>
<td style="text-align:left;">
plot
</td>
<td style="text-align:left;">
factweek5
</td>
<td style="text-align:right;">
0.022
</td>
<td style="text-align:right;">
0.013
</td>
<td style="text-align:right;">
0.038
</td>
</tr>
<tr>
<td style="text-align:left;">
Residual
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table>
<table class="table table-bordered table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
cor
</th>
<th style="text-align:right;">
factweek1
</th>
<th style="text-align:right;">
factweek2
</th>
<th style="text-align:right;">
factweek3
</th>
<th style="text-align:right;">
factweek4
</th>
<th style="text-align:right;">
factweek5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
factweek1
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.749
</td>
<td style="text-align:right;">
0.561
</td>
<td style="text-align:right;">
0.420
</td>
<td style="text-align:right;">
0.315
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
factweek2
</td>
<td style="text-align:right;">
0.749
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.749
</td>
<td style="text-align:right;">
0.561
</td>
<td style="text-align:right;">
0.420
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
factweek3
</td>
<td style="text-align:right;">
0.561
</td>
<td style="text-align:right;">
0.749
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.749
</td>
<td style="text-align:right;">
0.561
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
factweek4
</td>
<td style="text-align:right;">
0.420
</td>
<td style="text-align:right;">
0.561
</td>
<td style="text-align:right;">
0.749
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.749
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
factweek5
</td>
<td style="text-align:right;">
0.315
</td>
<td style="text-align:right;">
0.420
</td>
<td style="text-align:right;">
0.561
</td>
<td style="text-align:right;">
0.749
</td>
<td style="text-align:right;">
1.000
</td>
</tr>
</tbody>
</table>
</div>
<div id="sommer-1" class="section level2">
<h2>sommer</h2>
<p>Trying to use sommer here leads to making two sacrifices and as a result it can be argued whether this analysis with sommer is still what we are aiming for in this specific example. While yes, there is an <a href="https://cran.r-project.org/web/packages/sommer/sommer.pdf#Rfn.AR1.1" target="_blank">AR1 function in sommer</a>, the two major limitations with it regarding this scenario are:</p>
<ul>
<li>It cannot be used for the error term (<em>i.e.</em> in the <code>rcov=</code> argument), but must be applied for a random effect.</li>
<li>A fixed value for rho must actually be provided by the user via the <code>rho=</code> argument.</li>
</ul>
<p>The first point would not be such a big deal, if we could force the error variance to be 0. Then, the random term with the desired ar1-structure would simply mimic the error term, which is exactly what we do with <code>glmmTMB</code> in this chapter! However, since <code>sommer</code> does not allow us to force the error variance to be 0, we get an iid error variance <strong>and</strong> the desired ar1-structure for plots across weeks. Interestingly, <a href="https://onlinelibrary.wiley.com/doi/full/10.1111/jac.12267" target="_blank">Piepho &amp; Edmondson (2018)</a> actually fit this model as well in addition to the ar1 model and refer to it as “ar1 + nugget”. Strictly speaking, however, it simply is not the variance structure we were aiming for here.</p>
<p>The second point is simply a limitation in terms of finding the optimal parameters. Since rho is fixed to a value that we as the user must provide before the model iterates, the fitted model can only be as good as our provided rho.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">fixed.rho &lt;-<span class="st"> </span><span class="fl">0.7</span> <span class="co"># random guess</span></a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3">mod.ar1.somm &lt;-<span class="st"> </span><span class="kw">mmer</span>(<span class="dt">fixed  =</span> y <span class="op">~</span><span class="st"> </span>factweek <span class="op">+</span><span class="st"> </span>variety <span class="op">+</span><span class="st"> </span>block <span class="op">+</span><span class="st"> </span>factweek<span class="op">:</span>variety <span class="op">+</span><span class="st"> </span>factweek<span class="op">:</span>block, </a>
<a class="sourceLine" id="cb10-4" title="4">                     <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">vs</span>(factweek, <span class="dt">Gu =</span> <span class="kw">AR1</span>(factweek, <span class="dt">rho =</span> fixed.rho)),</a>
<a class="sourceLine" id="cb10-5" title="5">                     <span class="dt">rcov   =</span> <span class="op">~</span><span class="st"> </span>units, <span class="co"># default = iid</span></a>
<a class="sourceLine" id="cb10-6" title="6">                     <span class="dt">data   =</span> dat, <span class="dt">verbose=</span>F)</a>
<a class="sourceLine" id="cb10-7" title="7"></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="co"># Extract variance component estimates</span></a>
<a class="sourceLine" id="cb10-9" title="9">mod.ar1.somm.VC &lt;-<span class="st"> </span><span class="kw">summary</span>(mod.ar1.somm)<span class="op">$</span>varcomp </a></code></pre></div>
<table class="table table-bordered table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
grp
</th>
<th style="text-align:right;">
VarComp
</th>
<th style="text-align:right;">
VarCompSE
</th>
<th style="text-align:right;">
Zratio
</th>
<th style="text-align:left;">
Constraint
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
u:factweek.y-y
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
8.075207e+23
</td>
<td style="text-align:left;">
Positive
</td>
</tr>
<tr>
<td style="text-align:left;">
units.y-y
</td>
<td style="text-align:right;">
0.023
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
5.477000e+00
</td>
<td style="text-align:left;">
Positive
</td>
</tr>
</tbody>
</table>
<p>Note that rho is not reported as part of the variance component estimates - which makes sense, as it was not estimated.</p>
</div>
<div id="sas-1" class="section level2">
<h2>SAS</h2>
<p>Here, we write <code>type=ar(1)</code> in the <code>repeated</code> statement in order to get the desired variance structure for the error term.</p>


<textarea id="OQNFH">
proc mixed data=dat;
class variety block factweek plot;
model y=block variety factweek block*factweek variety*factweek /ddfm=kr2;
repeated factweek/sub=plot type=ar(1) rcorr; /* ar1 variance structure */
ods output covparms=modar1sasVC FitStatistics=modar1sasAIC;
run; 

proc print data=modar1sasVC;
run;
</textarea>
<script> var codeElement = document.getElementById("OQNFH"); var editor = null; if (null != codeElement) { editor = CodeMirror.fromTextArea(codeElement, { lineNumbers: true, readOnly: true, viewportMargin: Infinity, mode: 'text/x-sas' }); } </script>

<p><br/></p>
<table class="table table-bordered table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
mod
</th>
<th style="text-align:left;">
CovParm
</th>
<th style="text-align:left;">
Subject
</th>
<th style="text-align:right;">
Estimate
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
ar1
</td>
<td style="text-align:left;">
AR(1)
</td>
<td style="text-align:left;">
plot
</td>
<td style="text-align:right;">
0.749
</td>
</tr>
<tr>
<td style="text-align:left;">
ar1
</td>
<td style="text-align:left;">
Residual
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.022
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="model-fit" class="section level1 tabset tabset-fade tabset-pills">
<h1>Model fit</h1>
<p>After all, a decision must be made on whether the <code>ar1</code> variance structure for the error term was a good choice for modelling this dataset. More broadly speaking, it must be decided which of the models should be used for further investigations such as a test of fixed effects <em>etc</em>. As is standard procedure, we can do a model selection based on goodness-of-fit statistics such as the <a href="https://www.wikiwand.com/en/Akaike_information_criterion#" target="_blank">AIC</a> (Akaike information criterion).</p>
<p>For <code>nlme</code> and <code>glmmTMB</code>, we make use of the <a href="https://cran.r-project.org/web/packages/AICcmodavg/AICcmodavg.pdf#Rfn.aictab.1" target="_blank"><code>aictab()</code> function</a> from the helper package <a href="https://CRAN.R-project.org/package=AICcmodavg" target="_blank">AICcmodavg</a>.</p>
<div id="nlme-2" class="section level2">
<h2>nlme</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">AIC.nlme &lt;-<span class="st"> </span><span class="kw">aictab</span>(<span class="kw">list</span>(mod.iid.nlme, mod.ar1.nlme), <span class="dt">modnames =</span> <span class="kw">c</span>(<span class="st">&quot;iid&quot;</span>, <span class="st">&quot;ar1&quot;</span>))</a></code></pre></div>
<table class="table table-bordered table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Modnames
</th>
<th style="text-align:right;">
K
</th>
<th style="text-align:right;">
AICc
</th>
<th style="text-align:right;">
Delta_AICc
</th>
<th style="text-align:right;">
Res.LL
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
ar1
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
101.4
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
23.0
</td>
</tr>
<tr>
<td style="text-align:left;">
iid
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
137.6
</td>
<td style="text-align:right;">
36.2
</td>
<td style="text-align:right;">
1.9
</td>
</tr>
</tbody>
</table>
</div>
<div id="lme4-2" class="section level2">
<h2>lme4</h2>
<p><span style="color:red">not possible - see above.</span></p>
</div>
<div id="glmmtmb-2" class="section level2">
<h2>glmmTMB</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">AIC.glmm &lt;-<span class="st"> </span><span class="kw">aictab</span>(<span class="kw">list</span>(mod.iid.glmm, mod.ar1.glmm), <span class="dt">modnames =</span> <span class="kw">c</span>(<span class="st">&quot;iid&quot;</span>, <span class="st">&quot;ar1&quot;</span>))</a></code></pre></div>
<table class="table table-bordered table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Modnames
</th>
<th style="text-align:right;">
K
</th>
<th style="text-align:right;">
AICc
</th>
<th style="text-align:right;">
Delta_AICc
</th>
<th style="text-align:right;">
LL
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
ar1
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
101.4
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
23.0
</td>
</tr>
<tr>
<td style="text-align:left;">
iid
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
137.6
</td>
<td style="text-align:right;">
36.2
</td>
<td style="text-align:right;">
1.9
</td>
</tr>
</tbody>
</table>
</div>
<div id="sommer-2" class="section level2">
<h2>sommer</h2>
<p>Comparing AIC values from the two models once again shows that <code>sommer</code> does not really do what we are aiming for in this example. The AIC values for the two models are identical. The main reason for this is that they do not actually differ in the number of estimated parameters, since <em>rho</em> as the potentially second parameter here, was not estimated, but fixed by us.</p>
<p>[ Is this the whole story? …in progress… ]</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">somm.mods &lt;-<span class="st"> </span><span class="kw">list</span>(mod.iid.somm, mod.ar1.somm)</a>
<a class="sourceLine" id="cb13-2" title="2"></a>
<a class="sourceLine" id="cb13-3" title="3">AIC.somm &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb13-4" title="4">  <span class="dt">Modnames =</span> <span class="kw">c</span>(<span class="st">&quot;iid&quot;</span>, <span class="st">&quot;ar1&quot;</span>),</a>
<a class="sourceLine" id="cb13-5" title="5">  <span class="dt">AIC =</span> somm.mods <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(<span class="st">&quot;AIC&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>unlist,</a>
<a class="sourceLine" id="cb13-6" title="6">  <span class="dt">LL  =</span> somm.mods <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(<span class="st">&quot;monitor&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">lapply</span>(. <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">[</span><span class="st">`</span>(<span class="dv">1</span>, <span class="kw">ncol</span>(.))) <span class="op">%&gt;%</span><span class="st"> </span>unlist) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># last element in first row of &quot;monitor&quot;</span></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="st">  </span><span class="kw">arrange</span>(AIC)</a></code></pre></div>
<table class="table table-bordered table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Modnames
</th>
<th style="text-align:right;">
AIC
</th>
<th style="text-align:right;">
LL
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
iid
</td>
<td style="text-align:right;">
-73.3
</td>
<td style="text-align:right;">
76.67347
</td>
</tr>
<tr>
<td style="text-align:left;">
ar1
</td>
<td style="text-align:right;">
-73.3
</td>
<td style="text-align:right;">
76.67347
</td>
</tr>
</tbody>
</table>
</div>
<div id="sas-2" class="section level2">
<h2>SAS</h2>
<p>The model fit statistics have already been created via the <code>ods output</code> statement of the respective models and are displayed here jointly:</p>
<table class="table table-bordered table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
mod
</th>
<th style="text-align:right;">
-2 Res Log-Likelihood
</th>
<th style="text-align:right;">
AIC
</th>
<th style="text-align:right;">
AICC
</th>
<th style="text-align:right;">
BIC
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
iid
</td>
<td style="text-align:right;">
-3.7
</td>
<td style="text-align:right;">
-1.7
</td>
<td style="text-align:right;">
-1.7
</td>
<td style="text-align:right;">
-0.7
</td>
</tr>
<tr>
<td style="text-align:left;">
ar1
</td>
<td style="text-align:right;">
-46.0
</td>
<td style="text-align:right;">
-42.0
</td>
<td style="text-align:right;">
-41.7
</td>
<td style="text-align:right;">
-40.0
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>The <code>ar1</code> model has the smaller AIC value. Thus, we choose the <code>ar1</code> over the <code>iid</code> model, since the former has the better fit.</p>
<p>Notice that this outcome satisfies the aim of this chapter (<em>i.e.</em> having an <code>ar1</code> variance structure for the error term) but regarding the analysis of the underlying dataset, more steps can be taken in order to get concluding results. You can find further steps in <a href="https://onlinelibrary.wiley.com/doi/full/10.1111/jac.12267" target="_blank"><em>Example 4</em> in Piepho &amp; Edmondson (2018)</a> (see also the <a href="https://cran.r-project.org/web/packages/agriTutorial/vignettes/agriTutorialVignette.pdf#%5B%7B%22num%22%3A81%2C%22gen%22%3A0%7D%2C%7B%22name%22%3A%22XYZ%22%7D%2C28.346%2C813.543%2Cnull%5D" target="_blank">Agritutorial vigniette</a>). On one hand, they investigate more variance structure alternatives to <code>iid</code> and on the other hand, they continue selecting a suitable regression model for the time trend after selecting a sutiable variance structure.</p>
</div>
<div id="summary" class="section level1 tabset tabset-fade">
<h1>Summary</h1>
<div id="syntax" class="section level2">
<h2>Syntax</h2>
<table>
<thead>
<tr class="header">
<th>package</th>
<th>model syntax</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>nlme</code></td>
<td><code>correlation = corAR1(form = ~ TIME | SUBJECT)</code></td>
</tr>
<tr class="even">
<td><code>lme4</code></td>
<td><span style="color:red">not possible</span></td>
</tr>
<tr class="odd">
<td><code>glmmTMB</code></td>
<td><code>random = ~ ar1(TIME + 0 | SUBJECT), dispformula =  ~ 0</code></td>
</tr>
<tr class="even">
<td><code>sommer</code></td>
<td><code>random = ~ vs(TIME, Gu = AR1(TIME, rho = FIXED.RHO))</code></td>
</tr>
<tr class="odd">
<td><code>SAS</code></td>
<td><code>repeated TIME/sub=SUBJECT type=ar(1);</code></td>
</tr>
</tbody>
</table>
</div>
<div id="varcomp" class="section level2">
<h2>VarComp</h2>
<strong>mod.iid</strong>
<table class="table table-bordered table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
mod
</th>
<th style="text-align:left;">
estimate
</th>
<th style="text-align:right;">
nlme
</th>
<th style="text-align:left;">
lme4
</th>
<th style="text-align:right;">
glmmTMB
</th>
<th style="text-align:right;">
sommer
</th>
<th style="text-align:right;">
SAS
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
iid
</td>
<td style="text-align:left;">
variance
</td>
<td style="text-align:right;">
0.0231758
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.023
</td>
<td style="text-align:right;">
0.0231758
</td>
<td style="text-align:right;">
0.02318
</td>
</tr>
</tbody>
</table>
<strong>mod.ar1</strong>
<table class="table table-bordered table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
mod
</th>
<th style="text-align:left;">
estimate
</th>
<th style="text-align:right;">
nlme
</th>
<th style="text-align:left;">
lme4
</th>
<th style="text-align:right;">
glmmTMB
</th>
<th style="text-align:left;">
sommer
</th>
<th style="text-align:right;">
SAS
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
ar1
</td>
<td style="text-align:left;">
variance
</td>
<td style="text-align:right;">
0.0221555
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.022
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.02216
</td>
</tr>
<tr>
<td style="text-align:left;">
ar1
</td>
<td style="text-align:left;">
correlation
</td>
<td style="text-align:right;">
0.7489923
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.749
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.74900
</td>
</tr>
</tbody>
</table>
</div>
<div id="aic" class="section level2">
<h2>AIC</h2>
<table class="table table-bordered table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
mod
</th>
<th style="text-align:left;">
estimate
</th>
<th style="text-align:right;">
nlme
</th>
<th style="text-align:left;">
lme4
</th>
<th style="text-align:right;">
glmmTMB
</th>
<th style="text-align:right;">
sommer
</th>
<th style="text-align:right;">
SAS
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
iid
</td>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:right;">
101.4131
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
101.4130
</td>
<td style="text-align:right;">
-73.34693
</td>
<td style="text-align:right;">
-1.7
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
ar1
</td>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:right;">
137.6407
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
137.6407
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
-42.0
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="more-on-this" class="section level1">
<h1>More on this</h1>
<p><a href="https://www.linkedin.com/posts/mixed-model-academy_pain-dataanalysis-activity-6684009897169833984-kZdn/" target="_blank">Relevant post by Mixed Model Academy</a></p>
</div>

&nbsp;
<hr />
<p style="text-align: center;">Please feel free to contact us about any of this! </p>
<p style="text-align: center;"><span style="color: #003f75ff;"><em>schmidtpaul1989@outlook.com</em></span></p>

<!-- Add icon library -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<!-- Add font awesome icons -->
<p style="text-align: center;">
    <a href="https://www.researchgate.net/project/MMFAIR-Mixed-Models-for-Agriculture-in-R" class="fa fa-pencil" style="color: #003f75ff;"></a>
    <a href="https://www.linkedin.com/in/schmidtpaul1989/" class="fa fa-linkedin" style="color: #003f75ff;"></a>
    <a href="https://www.xing.com/profile/Paul_Schmidt393/cv" class="fa fa-xing" style="color: #003f75ff;"></a>
    <a href="https://github.com/SchmidtPaul/" class="fa fa-github" style="color: #003f75ff;"></a>
</p>

<a href="https://hits.seeyoufarm.com"><img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fschmidtpaul.github.io%2FMMFAIR%2F&count_bg=%23003F75&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=hits&edge_flat=false" class="center"/></a>

&nbsp;


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
